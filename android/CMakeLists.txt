cmake_minimum_required(VERSION 3.4.1)
# FIXME looks like the build script for android needs to fix up the platform cmake as in windows/ios.
# For now I'm just dumping find to get things going
#if(EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/libs/eegeo/platform/CMakeLists.txt")
#    include("${CMAKE_CURRENT_SOURCE_DIR}/libs/eegeo/platform/CMakeLists.txt")
#else(EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/libs/eegeo/platform/CMakeLists.txt")
#    message(FATAL_ERROR "Couldn't detect platform headers. Have you run update.platform.sh?")
#endif(EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/libs/eegeo/platform/CMakeLists.txt")

#include(${CMAKE_CURRENT_SOURCE_DIR}/../src/CMakeLists.txt)
#include(${CMAKE_CURRENT_SOURCE_DIR}/../libs/CMakeLists.txt)

include_directories(
	jni
	jni/MyPinDetails
	jni/MyPinDetails/View
	jni/Compass
	jni/Compass/View
	jni/SettingsMenu
	jni/SettingsMenu/View
	jni/MyPinCreation
	jni/MyPinCreation/View
	jni/SearchMenu
	jni/SearchMenu/View
	jni/FlattenButton
	jni/FlattenButton/View
	jni/Watermark
	jni/Watermark/View
	jni/SearchResultSection
	jni/SearchResultSection/View
	jni/PersistentSettings
	jni/ApplicationConfig
	jni/ApplicationConfig/SdkModel
	jni/SearchResultPoi
	jni/SearchResultPoi/View
	jni/InitialExperience
	jni/InitialExperience/Preload
	jni/InitialExperience/Preload/SdkModel
	jni/InitialExperience/View
	jni/InitialExperience/SdkModel
	jni/Helpers
	jni/TagSearch
	jni/TagSearch/View
	jni/Options
	jni/Options/View
	jni/Options/SdkModel
	jni/AndroidAppThreadAssertions
	jni/AboutPage
	jni/AboutPage/View
	jni/Menu
	jni/Menu/View
	jni/Menu/SdkModel
	jni/InteriorsExplorer
	jni/InteriorsExplorer/View
	jni/MyPins
	jni/MyPins/View
	jni/MyPinCreationDetails
	jni/MyPinCreationDetails/View
	jni/ModalBackground
	jni/ModalBackground/View
	jni/ModalBackground/SdkModel
	jni/WorldPins
	jni/WorldPins/View
	jni/Metrics

    ../src
    ../src/UserInteraction
    ../src/UserInteraction/SdkModel
    ../src/Social
    ../src/Social/TwitterFeed
    ../src/WifiInfo
    ../src/AppModes
    ../src/AppModes/SdkModel
    ../src/AppModes/States
    ../src/AppModes/States/SdkModel
    ../src/MyPinDetails
    ../src/MyPinDetails/View
    ../src/MyPinDetails/SdkModel
    ../src/Compass
    ../src/Compass/View
    ../src/Compass/SdkModel
    ../src/SettingsMenu
    ../src/SettingsMenu/View
    ../src/SettingsMenu/SdkModel
    ../src/MyPinCreation
    ../src/MyPinCreation/View
    ../src/MyPinCreation/SdkModel
    ../src/MyPinCreation/PoiRing
    ../src/MyPinCreation/PoiRing/SdkModel
    ../src/SearchMenu
    ../src/SearchMenu/View
    ../src/SearchMenu/SdkModel
    ../src/SwallowPoiDb
    ../src/SwallowPoiDb/Constants
    ../src/SwallowPoiDb/Parsers
    ../src/FlattenButton
    ../src/FlattenButton/View
    ../src/FlattenButton/SdkModel
    ../src/CameraTransitions
    ../src/CameraTransitions/SdkModel
    ../src/Watermark
    ../src/Watermark/View
    ../src/Watermark/SdkModel
    ../src/SearchResultSection
    ../src/SearchResultSection/View
    ../src/SearchResultSection/SdkModel
    ../src/Avatar
    ../src/Avatar/AvatarModule
    ../src/Avatar/SdkModel
    ../src/PersistentSettings
    ../src/ApplicationConfig
    ../src/ApplicationConfig/SdkModel
    ../src/ViewControllerUpdater
    ../src/ViewControllerUpdater/View
    ../src/AppCamera
    ../src/AppCamera/SdkModel
    ../src/AppCamera/Helpers
    ../src/SearchResultPoi
    ../src/SearchResultPoi/View
    ../src/SearchResultPoi/SdkModel
    ../src/InitialExperience
    ../src/InitialExperience/Preload
    ../src/InitialExperience/Preload/SdkModel
    ../src/InitialExperience/View
    ../src/InitialExperience/SdkModel
    ../src/Helpers
    ../src/TagSearch
    ../src/TagSearch/View
    ../src/TagSearch/SdkModel
    ../src/GpsMarker
    ../src/GpsMarker/SdkModel
    ../src/WorldAreaLoader
    ../src/WorldAreaLoader/SdkModel
    ../src/Options
    ../src/Options/View
    ../src/Options/SdkModel
    ../src/ExampleAppMessaging
    ../src/Modality
    ../src/Modality/View
    ../src/Search
    ../src/Search/GeoNames
    ../src/Search/GeoNames/SdkModel
    ../src/Search/Example
    ../src/Search/Example/SdkModel
    ../src/Search/SdkModel
    ../src/Search/SdkModel/MyPins
    ../src/Search/Yelp
    ../src/Search/Yelp/SdkModel
    ../src/Search/Yelp/SearchConstants
    ../src/Search/Swallow
    ../src/Search/Swallow/View
    ../src/Search/Swallow/SdkModel
    ../src/Search/Swallow/SdkModel/SearchParser
    ../src/Search/Swallow/SearchConstants
    ../src/Search/Combined
    ../src/Search/Combined/SdkModel
    ../src/Search/EegeoPois
    ../src/Search/EegeoPois/SdkModel
    ../src/AboutPage
    ../src/AboutPage/View
    ../src/ReportPinsVisibilityMasking
    ../src/ReportPinsVisibilityMasking/SdkModel
    ../src/DoubleTapIndoorInteraction
    ../src/DoubleTapIndoorInteraction/SdkModel
    ../src/RenderingTransformMesh
    ../src/RenderingTransformMesh/SdkModel
    ../src/Menu
    ../src/Menu/View
    ../src/IndoorLocation
    ../src/IndoorLocation/SdkModel
    ../src/InteriorsExplorer
    ../src/InteriorsExplorer/View
    ../src/InteriorsExplorer/SdkModel
    ../src/InteriorsExplorer/SdkModel/States
    ../src/InteriorsExplorer/SdkModel/Highlights
    ../src/InteriorsEntitiesPins
    ../src/InteriorsEntitiesPins/SdkModel
    ../src/Reaction
    ../src/Reaction/View
    ../src/Tours
    ../src/Tours/View
    ../src/Tours/View/TourFullScreenImage
    ../src/Tours/View/TourExplorer
    ../src/Tours/SdkModel
    ../src/Tours/SdkModel/Camera
    ../src/Tours/SdkModel/TourInstances
    ../src/Tours/SdkModel/TourInstances/Example
    ../src/Tours/SdkModel/TourInstances/TwitterFeed
    ../src/Tours/SdkModel/States
    ../src/Tours/TourFullScreenImage
    ../src/MyPins
    ../src/MyPins/View
    ../src/MyPins/SdkModel
    ../src/Net
    ../src/Net/SdkModel
    ../src/VisualMap
    ../src/VisualMap/SdkModel
    ../src/OpenableControl
    ../src/OpenableControl/View
    ../src/PlaceJumps
    ../src/PlaceJumps/View
    ../src/PlaceJumps/SdkModel
    ../src/URLRequest
    ../src/InteriorsPosition
    ../src/InteriorsPosition/SdkModel
    ../src/Repository
    ../src/CategorySearch
    ../src/MyPinCreationDetails
    ../src/MyPinCreationDetails/View
    ../src/WorldPins
    ../src/WorldPins/View
    ../src/WorldPins/SdkModel
    ../src/ScreenControl
    ../src/ScreenControl/View
    ../src/SearchResultOnMap
    ../src/SearchResultOnMap/View
    ../src/SearchResultOnMap/SdkModel
    ../src/MapMode
    ../src/MapMode/SdkModel
    ../src/Metrics

    libs/eegeo/rapidjson
    libs/eegeo/sdk-extensions/sqlite

	libs/eegeo/platform
	libs/eegeo/platform/Location
	libs/eegeo/platform/Culling
	libs/eegeo/platform/BuildingFootprints
	libs/eegeo/platform/Labels
	libs/eegeo/platform/UI
	libs/eegeo/platform/UI/NativeInput
	libs/eegeo/platform/UI/NativeInput/Android
	libs/eegeo/platform/UI/NativeInput/Windows
	libs/eegeo/platform/UI/NativeAlerts
	libs/eegeo/platform/UI/NativeAlerts/Android
	libs/eegeo/platform/UI/NativeAlerts/Windows
	libs/eegeo/platform/Modules
	libs/eegeo/platform/Modules/Data
	libs/eegeo/platform/Modules/Map
	libs/eegeo/platform/Modules/Map/Layers
	libs/eegeo/platform/Modules/Core
	libs/eegeo/platform/DataStructures
	libs/eegeo/platform/Messaging
	libs/eegeo/platform/Collision
	libs/eegeo/platform/Camera
	libs/eegeo/platform/Camera/GlobeCamera
	libs/eegeo/platform/Camera/SplinePlayback
	libs/eegeo/platform/Data
	libs/eegeo/platform/Data/Geofencing
	libs/eegeo/platform/Data/GeoJSON
	libs/eegeo/platform/Data/Heatmaps
	libs/eegeo/platform/Data/Heatmaps/Materials
	libs/eegeo/platform/Data/PolyChart
	libs/eegeo/platform/Data/StencilArea
	libs/eegeo/platform/Data/StencilArea/Materials
	libs/eegeo/platform/Rendering
	libs/eegeo/platform/Rendering/Filters
	libs/eegeo/platform/Rendering/Shaders
	libs/eegeo/platform/Rendering/SceneModels
	libs/eegeo/platform/Rendering/SceneModels/Animation
	libs/eegeo/platform/Rendering/SceneModels/Resources
	libs/eegeo/platform/Rendering/VertexLayouts
	libs/eegeo/platform/Rendering/Scene
	libs/eegeo/platform/Rendering/MeshFactories
	libs/eegeo/platform/Rendering/Geometry
	libs/eegeo/platform/Rendering/VertexTypes
	libs/eegeo/platform/Rendering/Renderables
	libs/eegeo/platform/Rendering/AsyncTexturing
	libs/eegeo/platform/Rendering/Materials
	libs/eegeo/platform/TextMeshes
	libs/eegeo/platform/TextMeshes/Internal
	libs/eegeo/platform/MemoryTracking
	libs/eegeo/platform/Routes
	libs/eegeo/platform/Routes/View
	libs/eegeo/platform/Routes/Style
	libs/eegeo/platform/Routes/Style/Thickness
	libs/eegeo/platform/Routes/Simulation
	libs/eegeo/platform/Routes/Simulation/View
	libs/eegeo/platform/Routes/Simulation/Camera
	libs/eegeo/platform/Routes/Webservice
	libs/eegeo/platform/Routes/Clipping
	libs/eegeo/platform/Routes/Fitting
	libs/eegeo/platform/Routes/Fitting/NavGraphConforming
	libs/eegeo/platform/Helpers
	libs/eegeo/platform/Helpers/Jpeg
	libs/eegeo/platform/Helpers/DDS
	libs/eegeo/platform/AnimatedObjects
	libs/eegeo/platform/Text
	libs/eegeo/platform/WorldStates
	libs/eegeo/platform/Geometry
	libs/eegeo/platform/Geometry/Intersection2d
	libs/eegeo/platform/Traffic
	libs/eegeo/platform/Traffic/Themes
	libs/eegeo/platform/Traffic/Config
	libs/eegeo/platform/Concurrency
	libs/eegeo/platform/Concurrency/Tasks
	libs/eegeo/platform/Concurrency/Tasks/Messages
	libs/eegeo/platform/Android
	libs/eegeo/platform/Android/KtxTextures
	libs/eegeo/platform/Android/Cache
	libs/eegeo/platform/Android/Input
	libs/eegeo/platform/Streaming
	libs/eegeo/platform/Streaming/BlockCoverageTrees
	libs/eegeo/platform/Streaming/SceneGraph
	libs/eegeo/platform/Streaming/Prioritisers
	libs/eegeo/platform/Streaming/Quadtree
	libs/eegeo/platform/Streaming/Volume
	libs/eegeo/platform/Streaming/Payload
	libs/eegeo/platform/Streaming/Debug
	libs/eegeo/platform/Streaming/Stream
	libs/eegeo/platform/Streaming/CoverageTrees
	libs/eegeo/platform/TrafficCongestion
	libs/eegeo/platform/Search
	libs/eegeo/platform/Search/Service
	libs/eegeo/platform/Emscripten
	libs/eegeo/platform/Emscripten/Api
	libs/eegeo/platform/Emscripten/Input
	libs/eegeo/platform/Emscripten/Debug
	libs/eegeo/platform/Config
	libs/eegeo/platform/Windows
	libs/eegeo/platform/Windows/Cache
	libs/eegeo/platform/Windows/Input
	libs/eegeo/platform/Windows/Input/TouchScreen
	libs/eegeo/platform/Windows/Input/Mouse
	libs/eegeo/platform/Fireworks
	libs/eegeo/platform/Base
	libs/eegeo/platform/Base/Model
	libs/eegeo/platform/Debug
	libs/eegeo/platform/Debug/BuildingFootprints
	libs/eegeo/platform/Debug/Labels
	libs/eegeo/platform/Debug/Commands
	libs/eegeo/platform/Debug/Commands/Labels
	libs/eegeo/platform/Debug/Commands/Coverage
	libs/eegeo/platform/Debug/Commands/Themes
	libs/eegeo/platform/Debug/Commands/Camera
	libs/eegeo/platform/Debug/Commands/PlaceNames
	libs/eegeo/platform/Debug/Commands/Rendering
	libs/eegeo/platform/Debug/Commands/Precache
	libs/eegeo/platform/Debug/Commands/Routes
	libs/eegeo/platform/Debug/Commands/TrafficCongestion
	libs/eegeo/platform/Debug/Commands/Profile
	libs/eegeo/platform/Debug/Commands/Stream
	libs/eegeo/platform/Debug/Commands/Web
	libs/eegeo/platform/Debug/Commands/Lighting
	libs/eegeo/platform/Debug/Commands/Stats
	libs/eegeo/platform/Debug/DebugServer
	libs/eegeo/platform/Debug/Profile
	libs/eegeo/platform/Debug/DebugRendering
	libs/eegeo/platform/Debug/DebugRendering/Renderers
	libs/eegeo/platform/Debug/Picking
	libs/eegeo/platform/Debug/SplinePlayback
	libs/eegeo/platform/Debug/Interiors
	libs/eegeo/platform/Fonts
	libs/eegeo/platform/Fonts/BMFont
	libs/eegeo/platform/CollisionVisualization
	libs/eegeo/platform/Web
	libs/eegeo/platform/Web/Cache
	libs/eegeo/platform/Web/Cache/WebRequestCacheTasks
	libs/eegeo/platform/Weather
	libs/eegeo/platform/Lighting
	libs/eegeo/platform/Icons
	libs/eegeo/platform/MapLayers
	libs/eegeo/platform/Pins
	libs/eegeo/platform/Io
	libs/eegeo/platform/Io/AsyncModels
	libs/eegeo/platform/Io/ChunkedFileFormat
	libs/eegeo/platform/Io/POD
	libs/eegeo/platform/Unicode
	libs/eegeo/platform/Resources
	libs/eegeo/platform/Resources/Terrain
	libs/eegeo/platform/Resources/Terrain/Placeholder
	libs/eegeo/platform/Resources/Terrain/Collision
	libs/eegeo/platform/Resources/Terrain/Raster
	libs/eegeo/platform/Resources/Terrain/Heights
	libs/eegeo/platform/Resources/Terrain/Lcm
	libs/eegeo/platform/Resources/Buildings
	libs/eegeo/platform/Resources/PlaceNames
	libs/eegeo/platform/Resources/CityThemes
	libs/eegeo/platform/Resources/CityThemes/BinaryThemeParsing
	libs/eegeo/platform/Resources/Roads
	libs/eegeo/platform/Resources/Roads/Navigation
	libs/eegeo/platform/Resources/Interiors
	libs/eegeo/platform/Resources/Interiors/Entities
	libs/eegeo/platform/Resources/Interiors/Builder
	libs/eegeo/platform/Resources/Interiors/MetaData
	libs/eegeo/platform/Resources/Interiors/Materials
	libs/eegeo/platform/Resources/Interiors/Markers
	libs/eegeo/platform/Networking
	libs/eegeo/platform/Networking/Windows
	libs/eegeo/platform/Networking/Posix
	libs/eegeo/platform/Space

    ../libs
    ../libs/OAuth
)

set(NDK_LIBS
	log
	android
	GLESv2
	EGL
	z
	m)

set(PREBUILT_STATIC_LIBS
	eegeo-sdk
	http-parser
	png
	turbojpeg
	curl
	eegeo-sdk-extensions-sqlite
	jpeg
	uv)

foreach(lib ${NDK_LIBS})
	find_library(${lib}-ndklib ${lib})
endforeach(lib)
foreach(lib ${PREBUILT_STATIC_LIBS})
	add_library(${lib} STATIC IMPORTED)
	set_target_properties(
		${lib}
		PROPERTIES IMPORTED_LOCATION
		${CMAKE_CURRENT_LIST_DIR}/libs/eegeo/prebuilt/android-${ANDROID_ABI}/lib${lib}.a)
endforeach(lib)

file(GLOB_RECURSE jni_SOURCES ${CMAKE_CURRENT_LIST_DIR}/jni/*.cpp)
# FIXME See top of the file.
file(GLOB_RECURSE src_SOURCES ${CMAKE_CURRENT_LIST_DIR}/../src/*.cpp)
file(GLOB_RECURSE external_SOURCES ${CMAKE_CURRENT_LIST_DIR}/../libs/*.cpp)

set(CMAKE_CPP_FLAGS  "${CMAKE_CPP_FLAGS} -Wall -Wno-unknown-pragmas -Wno-sign-compare -Wno-format-security -Wno-reorder")
set(CMAKE_CXX_FLAGS  "${CMAKE_CXX_FLAGS} -fexceptions -std=c++11")
set(CMAKE_SHARED_LINKER_FLAGS  "${CMAKE_SHARED_LINKER_FLAGS} -Wl,--stub-group-size=2085000")

add_library(ssl-prebuilt STATIC IMPORTED)
set_target_properties(ssl-prebuilt PROPERTIES IMPORTED_LOCATION ${CMAKE_CURRENT_LIST_DIR}/libs/eegeo/prebuilt/android-${ANDROID_ABI}/libssl.a)
add_library(crypto-prebuilt STATIC IMPORTED)
set_target_properties(crypto-prebuilt PROPERTIES IMPORTED_LOCATION ${CMAKE_CURRENT_LIST_DIR}/libs/eegeo/prebuilt/android-${ANDROID_ABI}/libcrypto.a)

add_library(eegeo-mobile-example-app
	SHARED
	${jni_SOURCES}
	${src_SOURCES}
	${external_SOURCES})
target_link_libraries(eegeo-mobile-example-app
	${PREBUILT_STATIC_LIBS}
	ssl-prebuilt
	crypto-prebuilt
	${log-ndklib}
	${atomic-ndklib}
	${android-ndklib}
	${GLESv2-ndklib}
	${EGL-ndklib}
	${z-ndklib}
	${m-ndklib})
